
import javafx.fxml.FXML;
import javafx.scene.control.*;

public class DonoController {
    @FXML private TextField txtNomeRestaurante, txtEndereco;
    @FXML private TextField txtNomeProd, txtDescProd, txtPreco, txtTempo, txtExtra1;
    @FXML private RadioButton rbComida, rbBebida;
    @FXML private CheckBox chkVeg;
    @FXML private ListView<Produto> listaProdutos;

    private Restaurante restauranteAtual;
    private ToggleGroup grupoTipo;

    @FXML
    public void initialize() {
        grupoTipo = new ToggleGroup();
        rbComida.setToggleGroup(grupoTipo);
        rbBebida.setToggleGroup(grupoTipo);
        
        // Lógica simples para alternar dicas de texto
        rbComida.setOnAction(e -> {
            txtExtra1.setPromptText("Tipo de Cozinha");
            chkVeg.setText("Vegetariano");
        });
        rbBebida.setOnAction(e -> {
            txtExtra1.setPromptText("Tamanho (ml)");
            chkVeg.setText("Alcoólica");
        });
    }

    @FXML
    public void handleCriarRestaurante() {
        String nome = txtNomeRestaurante.getText();
        String end = txtEndereco.getText();
        // Cria ou recupera (simplificado: sempre cria novo para demo)
        restauranteAtual = new Restaurante(nome, end);
        BancoDeDados.getInstance().salvarRestaurante(restauranteAtual);
        atualizarLista();
        alerta("Sucesso", "Restaurante " + nome + " criado!");
    }

    @FXML
    public void handleAdicionarProduto() {
        if (restauranteAtual == null) {
            alerta("Erro", "Crie o restaurante primeiro.");
            return;
        }
        try {
            String nome = txtNomeProd.getText();
            String desc = txtDescProd.getText();
            double preco = Double.parseDouble(txtPreco.getText());
            int tempo = Integer.parseInt(txtTempo.getText());

            Produto p;
            if (rbComida.isSelected()) {
                String cozinha = txtExtra1.getText();
                boolean veg = chkVeg.isSelected();
                p = new Comida(nome, desc, preco, tempo, cozinha, veg, false); // Vegano false por simplicidade
            } else {
                int ml = Integer.parseInt(txtExtra1.getText());
                boolean alc = chkVeg.isSelected();
                p = new Bebida(nome, desc, preco, tempo, ml, alc);
            }

            restauranteAtual.adicionarProduto(p);
            atualizarLista();
            limparCamposProduto();

        } catch (Exception e) {
            alerta("Erro", "Verifique os dados inseridos.");
        }
    }

    @FXML
    public void handleRemoverProduto() {
        Produto p = listaProdutos.getSelectionModel().getSelectedItem();
        if (p != null && restauranteAtual != null) {
            restauranteAtual.removerProduto(p);
            atualizarLista();
        }
    }

    private void atualizarLista() {
        if (restauranteAtual != null) {
            listaProdutos.getItems().setAll(restauranteAtual.getCardapio());
        }
    }

    private void limparCamposProduto() {
        txtNomeProd.clear(); txtDescProd.clear(); txtPreco.clear();
        txtTempo.clear(); txtExtra1.clear(); chkVeg.setSelected(false);
    }

    private void alerta(String titulo, String msg) {
        Alert alert = new Alert(Alert.AlertType.INFORMATION);
        alert.setTitle(titulo);
        alert.setContentText(msg);
        alert.showAndWait();
    }
}
